<div class="users-component">
  <div class="component-header">
    <h3>× ×™×”×•×œ ××©×ª××©×™×</h3>
  </div>

  <div class="layout-container">
    <div class="left-panel">
      <div class="users-section">
        <h4>×¨×©×™××ª ××©×ª××©×™×</h4>

        @if (loading()) {
        <div class="loading">×˜×•×¢×Ÿ × ×ª×•× ×™×...</div>
        } @if (error()) {
        <div class="error">
          ×©×’×™××”: {{ error().message || error() }}
          <button (click)="clearError()">âœ•</button>
        </div>
        }

        <div class="users-list scrollable-list">
          @for (user of users(); track user.id) {
          <div class="user-item" [class.selected]="selectedUser()?.id === user.id">
            <div class="user-info">
              <div class="user-avatar">{{ user.name.charAt(0) }}</div>
              <div class="user-name">{{ user.name }}</div>
            </div>
            <div class="user-actions">
              <button
                (click)="selectUser(user.id)"
                class="btn"
                [disabled]="selectedUser()?.id === user.id"
              >
                {{ selectedUser()?.id === user.id ? '× ×‘×—×¨' : '×‘×—×¨' }}
              </button>
              <button
                (click)="editUser(user)"
                class="btn"
                [disabled]="isEditing() && editingUser()?.id === user.id"
              >
                ×¢×¨×•×š
              </button>
              <button (click)="deleteUser(user.id)" class="btn danger">××—×§</button>
            </div>
          </div>
          }
        </div>

        @if (selectedUser()) {
        <button (click)="clearUserSelection()" class="btn clear-selection-btn">×‘×˜×œ ×‘×—×™×¨×”</button>
        }
      </div>
    </div>

    <div class="right-panel">
      <div class="top-section">
        @if (isEditing()) {
        <div class="form-section">
          <h4>×¢×¨×™×›×ª ××©×ª××©</h4>
          <div class="form-group">
            <label>××–×”×”</label>
            <input type="number" [(ngModel)]="editingUser()!.id" readonly />
          </div>
          <div class="form-group">
            <label>×©×</label>
            <input type="text" [(ngModel)]="editingUser()!.name" />
          </div>
          <div class="form-actions">
            <button (click)="saveUser()" class="btn primary">×©××•×¨</button>
            <button (click)="cancelEdit()" class="btn">×‘×˜×œ</button>
          </div>
        </div>
        } @else {
        <div class="form-section">
          <h4>×”×•×¡×¤×ª ××©×ª××© ×—×“×©</h4>
          <div class="form-group">
            <label>×©×</label>
            <input type="text" [(ngModel)]="newUser().name" placeholder="×©× ×”××©×ª××©" />
          </div>
          <div class="form-actions">
            <button (click)="saveUser()" class="btn primary">×”×•×¡×£</button>
          </div>
        </div>
        } @if (selectedUser() && !isEditing()) {
        <div class="form-section add-order-form">
          <h4>×”×•×¡×¤×ª ×”×–×× ×” ×œ××©×ª××©</h4>
          <div class="form-group">
            <label>×¡×›×•× ×”×”×–×× ×” (â‚ª)</label>
            <input
              type="number"
              [(ngModel)]="newOrderAmount"
              placeholder="×”×›× ×¡ ×¡×›×•×"
              min="0"
              step="0.01"
            />
          </div>
          <div class="form-actions">
            <button (click)="addOrder()" class="btn primary">×”×•×¡×£ ×”×–×× ×”</button>
          </div>
        </div>
        }
      </div>

      <div class="bottom-section">
        @if (selectedUser()) { @if (userDetailsLoading()) {
        <div class="user-details-loading">
          <div class="loading-spinner"></div>
          <p>×˜×•×¢×Ÿ ×¤×¨×˜×™ ××©×ª××©...</p>
        </div>
        } @else if (selectedUserSummary().userName) {
        <div class="user-summary">
          <h4>×¡×™×›×•× ×”××©×ª××© ×”× ×‘×—×¨</h4>
          <p><strong>×©×:</strong> {{ selectedUserSummary().userName }}</p>
          <p><strong>×”×–×× ×•×ª:</strong> {{ selectedUserSummary().ordersCount }}</p>
          <p><strong>×¡×”"×›:</strong> â‚ª{{ selectedUserSummary().totalOrdersSum.toFixed(2) }}</p>
        </div>

        <div class="orders-details">
          <h4>×¤×™×¨×•×˜ ×”×–×× ×•×ª</h4>
          @if (selectedUserOrders().length > 0) {
          <div class="orders-list scrollable-orders">
            @for (order of selectedUserOrders(); track order.id) {
            <div class="order-item">
              <div class="order-header">
                <div class="order-info">
                  <span class="order-id">×”×–×× ×” #{{ order.id }}</span>
                  <span class="order-date">{{ formatDate(order.orderDate) }}</span>
                  <span class="order-status" [class]="'status-' + order.status">
                    {{ getStatusText(order.status) }}
                  </span>
                </div>
                <div class="order-total">â‚ª{{ order.total.toFixed(2) }}</div>
              </div>

              <div class="order-items">
                @for (item of order.items; track item.id) {
                <div class="order-item-detail">
                  <span class="item-name">{{ item.productName }}</span>
                  <span class="item-category">{{ item.category }}</span>
                  <span class="item-quantity">×›××•×ª: {{ item.quantity }}</span>
                  <span class="item-price">â‚ª{{ item.price.toFixed(2) }}</span>
                  <span class="item-total">â‚ª{{ (item.price * item.quantity).toFixed(2) }}</span>
                </div>
                }
              </div>
            </div>
            }
          </div>
          } @else {
          <p class="no-orders">××™×Ÿ ×”×–×× ×•×ª ×œ××©×ª××© ×–×”</p>
          }
        </div>
        } } @else {
        <div class="no-selection">
          <div class="no-selection-icon">ğŸ“‹</div>
          <h4>×‘×—×¨ ××©×ª××© ×œ×¦×¤×™×™×” ×‘×¤×¨×˜×™×</h4>
          <p>×‘×—×¨ ××©×ª××© ××”×¨×©×™××” ×›×“×™ ×œ×¨××•×ª ××ª ×”×¤×¨×˜×™× ×•×”×–×× ×•×ª ×©×œ×•</p>
        </div>
        }
      </div>
    </div>
  </div>
</div>
